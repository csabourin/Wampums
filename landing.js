const translations = {
	fr: {
		skip_link: "Passer au contenu principal",
		nav_login: "Se connecter",
		tagline: "Application web bilingue pour les scouts",
		hero_title:
			"Orchestrez vos réunions hebdomadaires, vos parents et vos équipes en toute sérénité.",
		hero_body:
			"Wampums centralise l'organisation des groupes scouts : agenda des rencontres, présence, progression, communications et documents, pour que chaque réunion soit prête et sécuritaire.",
		badge1: "Planification mobile-first",
		badge2: "Suivi badges et présences",
		badge3: "Parents connectés",
		cta_primary: "Voir les plans",
		cta_secondary: "Découvrir les fonctions",
		card_title: "Tout-en-un pour votre groupe",
		card_subtitle:
			"Suivi des membres, activités, badges, documents et paiements.",
		stat1_label: "Réunions prêtes",
		stat2_label: "Présences tracées",
		stat3_label: "Parents informés",

		// Pricing
		pricing_title: "Des plans adaptés à votre groupe",
		pricing_body:
			"Commencez gratuitement et évoluez selon vos besoins. Pas de carte de crédit requise.",

		plan_free_name: "Découverte",
		plan_free_period: "pour toujours",
		plan_free_note: "Idéal pour les petits groupes",
		plan_free_feature1: "Jusqu'à 20 scouts",
		plan_free_feature2: "Gestion des présences",
		plan_free_feature3: "Suivi des badges",
		plan_free_feature4: "Calendrier des réunions",
		plan_free_feature5: "Application mobile (PWA)",
		plan_free_feature6: "Rapports avancés",
		plan_free_feature7: "Paiements en ligne",
		plan_free_cta: "Demander une démo",

		plan_pro_badge: "Populaire",
		plan_pro_name: "Professionnel",
		plan_pro_period: "/mois",
		plan_pro_note: "Pour les unités actives",
		plan_pro_feature1: "Scouts illimités",
		plan_pro_feature2: "Toutes les fonctions de base",
		plan_pro_feature3: "Rapports et statistiques",
		plan_pro_feature4: "Paiements en ligne (Stripe)",
		plan_pro_feature5: "Notifications par courriel",
		plan_pro_feature6: "Gestion des documents",
		plan_pro_feature7: "Support prioritaire",
		plan_pro_cta: "Demander une démo",

		plan_council_name: "District",
		plan_council_period: "/mois",
		plan_council_note: "Pour les conseils et districts",
		plan_council_feature1: "Multi-organisations",
		plan_council_feature2: "Toutes les fonctions Pro",
		plan_council_feature3: "Tableau de bord district",
		plan_council_feature4: "Rapports consolidés",
		plan_council_feature5: "Accès API",
		plan_council_feature6: "Domaine personnalisé",
		plan_council_feature7: "Gestionnaire de compte dédié",
		plan_council_cta: "Contacter les ventes",

		// Features
		features_title: "Fonctions conçues pour les unités scoutes",
		features_body:
			"Chaque module est pensé pour les réalités des équipes d'animation : préparation rapide, suivi clair et collaboration avec les parents.",
		feature1_title: "Planification des rencontres",
		feature1_body:
			"Planifiez les activités hebdomadaires, matériaux et responsabilités, avec un calendrier partagé.",
		feature2_title: "Présences et progression",
		feature2_body:
			"Consignez les présences, les points et l'avancement des badges ou honneurs.",
		feature3_title: "Communication aux parents",
		feature3_body:
			"Envoyez des nouvelles, rappels et documents pour que les familles restent alignées.",
		feature4_title: "Gestion des rôles",
		feature4_body:
			"Attribuez les rôles (admin, animation, parents) et sécurisez l'accès aux données.",
		feature5_title: "Documents et consentements",
		feature5_body:
			"Stockez fiches santé, autorisations et rapports pour des activités conformes.",
		feature6_title: "Rapports et export",
		feature6_body:
			"Générez des rapports sur la participation, la progression et les ventes de calendriers.",

		// Weekly
		weekly_title: "Prêt pour chaque réunion hebdomadaire",
		weekly_body:
			"Un fil conducteur clair pour préparer, tenir et archiver vos rencontres avec fiabilité.",
		weekly_step1_title: "Avant la réunion",
		weekly_step1_item1:
			"Ajoutez l'activité, l'objectif d'apprentissage et les ressources nécessaires.",
		weekly_step1_item2:
			"Assignez les responsables et partagez la liste avec l'équipe.",
		weekly_step1_item3:
			"Envoyez un rappel aux parents avec les détails logistiques.",
		weekly_step2_title: "Pendant la réunion",
		weekly_step2_item1:
			"Enregistrez les présences et les points en direct sur mobile.",
		weekly_step2_item2: "Notez les progrès de badges ou tout besoin de suivi.",
		weekly_step2_item3:
			"Consignez les observations pour le rapport de fin de rencontre.",
		weekly_step3_title: "Après la réunion",
		weekly_step3_item1: "Envoyez un compte rendu aux parents et à l'équipe.",
		weekly_step3_item2:
			"Mettez à jour les inventaires, les paiements et les documents.",
		weekly_step3_item3:
			"Planifiez la prochaine rencontre à partir du modèle existant.",

		// Benefits
		benefits_title: "Pourquoi Wampums aide votre communauté",
		benefit1_title: "Animation efficace",
		benefit1_body:
			"Moins d'administration, plus de temps sur le terrain grâce à des modèles et rappels prêts à l'emploi.",
		benefit2_title: "Parents rassurés",
		benefit2_body:
			"Informations claires, notifications rapides et documents centralisés pour suivre l'avancement.",
		benefit3_title: "Sécurité et conformité",
		benefit3_body:
			"Gestion des autorisations, des rôles et des dossiers pour des activités sécuritaires.",

		// FAQ
		faq_title: "Questions fréquentes",
		faq1_question: "Puis-je changer de plan à tout moment?",
		faq1_answer:
			"Oui! Vous pouvez passer à un plan supérieur ou inférieur à tout moment. Les changements prennent effet immédiatement.",
		faq2_question: "Y a-t-il un engagement minimum?",
		faq2_answer:
			"Non, tous nos plans sont sans engagement. Vous pouvez annuler à tout moment sans frais.",
		faq3_question: "Comment fonctionnent les paiements en ligne?",
		faq3_answer:
			"Nous utilisons Stripe pour traiter les paiements de façon sécurisée. Les parents peuvent payer les frais directement en ligne.",
		faq4_question: "Mes données sont-elles sécurisées?",
		faq4_answer:
			"Absolument. Nous utilisons le chiffrement SSL, des sauvegardes automatiques et respectons les normes de confidentialité canadiennes.",

		// CTA
		cta_title: "Prêt à simplifier la gestion de votre groupe?",
		cta_body:
			"Rejoignez des centaines de groupes scouts qui font confiance à Wampums pour leurs réunions hebdomadaires.",
		cta_button: "Demander une démo",

		// Demo Modal
		demo_modal_title: "Demander une démo",
		demo_form_name: "Nom",
		demo_form_email: "Courriel",
		demo_form_organization: "Organisation",
		demo_form_phone: "Téléphone",
		demo_form_message: "Message",
		demo_form_message_help: "Parlez-nous de vos besoins",
		demo_form_submit: "Envoyer la demande",
		demo_form_success:
			"Merci! Votre demande a été soumise avec succès. Vous serez redirigé vers la démo...",
		demo_form_name_error: "Le nom est requis",
		demo_form_email_error: "Courriel invalide",
		demo_form_message_error: "Le message est requis (minimum 10 caractères)",

		footer_note:
			"Conçu pour les groupes scouts qui se rencontrent chaque semaine — simple, bilingue et prêt à l'emploi.",
	},
	en: {
		skip_link: "Skip to main content",
		nav_login: "Sign in",
		tagline: "Bilingual web app for scouting groups",
		hero_title:
			"Coordinate weekly meetings, parents, and crews with confidence.",
		hero_body:
			"Wampums centralizes scout group operations: meeting schedules, attendance, advancement, communications, and documents so every gathering is ready and safe.",
		badge1: "Mobile-first planning",
		badge2: "Badge and attendance tracking",
		badge3: "Parents stay informed",
		cta_primary: "View plans",
		cta_secondary: "Explore features",
		card_title: "All-in-one for your troop",
		card_subtitle:
			"Track members, activities, badges, documents, and payments.",
		stat1_label: "Meetings prepared",
		stat2_label: "Attendance captured",
		stat3_label: "Parents updated",

		// Pricing
		pricing_title: "Plans that fit your group",
		pricing_body: "Start free and scale as you grow. No credit card required.",

		plan_free_name: "Starter",
		plan_free_period: "forever",
		plan_free_note: "Perfect for small groups",
		plan_free_feature1: "Up to 20 scouts",
		plan_free_feature2: "Attendance management",
		plan_free_feature3: "Badge tracking",
		plan_free_feature4: "Meeting calendar",
		plan_free_feature5: "Mobile app (PWA)",
		plan_free_feature6: "Advanced reports",
		plan_free_feature7: "Online payments",
		plan_free_cta: "Request a demo",

		plan_pro_badge: "Popular",
		plan_pro_name: "Professional",
		plan_pro_period: "/month",
		plan_pro_note: "For active units",
		plan_pro_feature1: "Unlimited scouts",
		plan_pro_feature2: "All basic features",
		plan_pro_feature3: "Reports & analytics",
		plan_pro_feature4: "Online payments (Stripe)",
		plan_pro_feature5: "Email notifications",
		plan_pro_feature6: "Document management",
		plan_pro_feature7: "Priority support",
		plan_pro_cta: "Request a demo",

		plan_council_name: "District",
		plan_council_period: "/month",
		plan_council_note: "For councils & districts",
		plan_council_feature1: "Multi-organization",
		plan_council_feature2: "All Pro features",
		plan_council_feature3: "District dashboard",
		plan_council_feature4: "Consolidated reports",
		plan_council_feature5: "API access",
		plan_council_feature6: "Custom domain",
		plan_council_feature7: "Dedicated account manager",
		plan_council_cta: "Contact sales",

		// Features
		features_title: "Built for weekly scout units",
		features_body:
			"Every module fits real-world leadership needs: quick prep, clear follow-up, and tight parent collaboration.",
		feature1_title: "Meeting planning",
		feature1_body:
			"Schedule weekly activities, materials, and responsibilities with a shared calendar.",
		feature2_title: "Attendance & advancement",
		feature2_body: "Record attendance, points, and badge or honor progress.",
		feature3_title: "Parent communications",
		feature3_body:
			"Send updates, reminders, and documents so families stay aligned.",
		feature4_title: "Role management",
		feature4_body:
			"Assign roles (admin, leaders, parents) and secure access to data.",
		feature5_title: "Documents & consents",
		feature5_body:
			"Store health forms, permissions, and reports to keep activities compliant.",
		feature6_title: "Reports & export",
		feature6_body:
			"Generate reports on participation, advancement, and calendar sales.",

		// Weekly
		weekly_title: "Ready for every weekly meeting",
		weekly_body:
			"A clear guide to prepare, deliver, and archive each gathering reliably.",
		weekly_step1_title: "Before the meeting",
		weekly_step1_item1:
			"Add the activity, learning goal, and required resources.",
		weekly_step1_item2: "Assign leaders and share the checklist with the crew.",
		weekly_step1_item3: "Send a reminder to parents with logistics.",
		weekly_step2_title: "During the meeting",
		weekly_step2_item1: "Capture attendance and points live on mobile.",
		weekly_step2_item2: "Log badge progress or any follow-up needs.",
		weekly_step2_item3: "Record observations for the end-of-meeting report.",
		weekly_step3_title: "After the meeting",
		weekly_step3_item1: "Share a recap with parents and the team.",
		weekly_step3_item2: "Update inventories, payments, and documents.",
		weekly_step3_item3: "Plan the next gathering using the existing template.",

		// Benefits
		benefits_title: "How Wampums supports your community",
		benefit1_title: "Effective leadership",
		benefit1_body:
			"Less admin, more time outdoors thanks to ready-to-use templates and reminders.",
		benefit2_title: "Confident parents",
		benefit2_body:
			"Clear information, fast notifications, and centralized documents to follow progress.",
		benefit3_title: "Safety and compliance",
		benefit3_body:
			"Manage permissions, roles, and records to keep activities safe.",

		// FAQ
		faq_title: "Frequently asked questions",
		faq1_question: "Can I switch plans anytime?",
		faq1_answer:
			"Yes! You can upgrade or downgrade at any time. Changes take effect immediately.",
		faq2_question: "Is there a minimum commitment?",
		faq2_answer:
			"No, all our plans are commitment-free. You can cancel anytime at no cost.",
		faq3_question: "How do online payments work?",
		faq3_answer:
			"We use Stripe to process payments securely. Parents can pay fees directly online.",
		faq4_question: "Is my data secure?",
		faq4_answer:
			"Absolutely. We use SSL encryption, automatic backups, and comply with Canadian privacy standards.",

		// CTA
		cta_title: "Ready to simplify your group management?",
		cta_body:
			"Join hundreds of scout groups who trust Wampums for their weekly meetings.",
		cta_button: "Request a demo",

		// Demo Modal
		demo_modal_title: "Request a demo",
		demo_form_name: "Name",
		demo_form_email: "Email",
		demo_form_organization: "Organization",
		demo_form_phone: "Phone",
		demo_form_message: "Message",
		demo_form_message_help: "Tell us about your needs",
		demo_form_submit: "Submit request",
		demo_form_success:
			"Thank you! Your request has been submitted successfully. You will be redirected to the demo...",
		demo_form_name_error: "Name is required",
		demo_form_email_error: "Invalid email",
		demo_form_message_error: "Message is required (minimum 10 characters)",

		footer_note:
			"Built for scout groups that meet every week — simple, bilingual, and ready to deploy.",
	},
};

const html = document.documentElement;
const buttons = document.querySelectorAll(".lang-toggle button");

function applyTranslations(lang) {
	const copy = translations[lang];
	if (!copy) return;
	html.lang = lang;
	document.title =
		lang === "fr"
			? "Wampums - Gestion des scouts"
			: "Wampums - Scout Management";
	document.querySelectorAll("[data-i18n]").forEach((node) => {
		const key = node.getAttribute("data-i18n");
		if (copy[key]) {
			node.textContent = copy[key];
		}
	});
	buttons.forEach((btn) =>
		btn.setAttribute(
			"aria-pressed",
			btn.dataset.lang === lang ? "true" : "false",
		),
	);
	localStorage.setItem("wampums-lang", lang);
}

buttons.forEach((button) => {
	button.addEventListener("click", () =>
		applyTranslations(button.dataset.lang),
	);
});

// Load saved language preference or default to French
const savedLang = localStorage.getItem("wampums-lang") || "fr";
applyTranslations(savedLang);

// Demo Modal Functionality
const demoModal = document.getElementById("demoModal");
const demoForm = document.getElementById("demoForm");
const formSuccess = document.getElementById("formSuccess");
const demoRedirectForm = document.getElementById("demoRedirectForm");

// Get backend API URL - try to detect from current location
const getApiUrl = () => {
	// If on wampums.app, use the demo API instance
	if (window.location.hostname === "wampums.app") {
		return "https://demo.wampums.app/api/contact-demo";
	}
	// For local development or other domains
	return window.location.origin + "/api/contact-demo";
};

// Open modal
document.querySelectorAll("[data-open-demo-modal]").forEach((button) => {
	button.addEventListener("click", () => {
		demoModal.classList.add("active");
		demoModal.setAttribute("aria-hidden", "false");
		// Focus first input
		document.getElementById("name").focus();
	});
});

// Close modal
const closeModal = () => {
	demoModal.classList.remove("active");
	demoModal.setAttribute("aria-hidden", "true");
	// Reset form
	demoForm.reset();
	formSuccess.classList.remove("active");
	// Clear errors
	document.querySelectorAll(".form-group.error").forEach((group) => {
		group.classList.remove("error");
	});
};

document.querySelectorAll("[data-close-modal]").forEach((button) => {
	button.addEventListener("click", closeModal);
});

// Close on background click
demoModal.addEventListener("click", (e) => {
	if (e.target === demoModal) {
		closeModal();
	}
});

// Close on Escape key
document.addEventListener("keydown", (e) => {
	if (e.key === "Escape" && demoModal.classList.contains("active")) {
		closeModal();
	}
});

// Form validation
const validateEmail = (email) => {
	return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
};

const validateForm = () => {
	let isValid = true;
	const name = document.getElementById("name");
	const email = document.getElementById("email");
	const message = document.getElementById("message");

	// Clear previous errors
	document.querySelectorAll(".form-group.error").forEach((group) => {
		group.classList.remove("error");
	});

	// Validate name
	if (!name.value.trim() || name.value.trim().length < 2) {
		name.closest(".form-group").classList.add("error");
		isValid = false;
	}

	// Validate email
	if (!email.value.trim() || !validateEmail(email.value.trim())) {
		email.closest(".form-group").classList.add("error");
		isValid = false;
	}

	// Validate message
	if (!message.value.trim() || message.value.trim().length < 10) {
		message.closest(".form-group").classList.add("error");
		isValid = false;
	}

	return isValid;
};

// Handle form submission
demoForm.addEventListener("submit", async (e) => {
	e.preventDefault();

	if (!validateForm()) {
		return;
	}

	const submitButton = demoForm.querySelector(".btn-submit");
	submitButton.disabled = true;
	submitButton.textContent =
		savedLang === "fr" ? "Envoi en cours..." : "Sending...";

	try {
		const formData = {
			name: document.getElementById("name").value.trim(),
			email: document.getElementById("email").value.trim(),
			organization: document.getElementById("organization").value.trim(),
			phone: document.getElementById("phone").value.trim(),
			message: document.getElementById("message").value.trim(),
			honeypot: document.getElementById("honeypot").value,
		};

		const response = await fetch(getApiUrl(), {
			method: "POST",
			headers: {
				"Content-Type": "application/json",
			},
			body: JSON.stringify(formData),
		});

		const data = await response.json();

		if (response.ok && data.success) {
			// Show success message
			formSuccess.classList.add("active");
			demoForm.style.display = "none";

			// Wait 2 seconds then authenticate and redirect to demo
			setTimeout(async () => {
				try {
					// Authenticate with demo credentials
					const loginResponse = await fetch(
						"https://demo.wampums.app/public/login",
						{
							method: "POST",
							headers: {
								"Content-Type": "application/json",
							},
							body: JSON.stringify({
								email: "akela.demo@demo.com",
								password: "Aylmer2025",
							}),
						},
					);

					const loginData = await loginResponse.json();

					if (loginResponse.ok && loginData.success && loginData.token) {
						// Store the token and redirect to the app
						localStorage.setItem("token", loginData.token);
						localStorage.setItem("user_role", loginData.user_role);
						localStorage.setItem("user_full_name", loginData.user_full_name);
						localStorage.setItem("user_id", loginData.user_id);

						// Redirect to the main app
						window.location.href = "https://demo.wampums.app/dashboard";
					} else {
						// If login fails, just redirect to login page
						window.location.href = "https://wampums.app/";
					}
				} catch (error) {
					console.error("Error authenticating:", error);
					// On error, just redirect to login page
					window.location.href = "https://wampums.app/";
				}
			}, 2000);
		} else {
			// Show error
			alert(
				data.message ||
					(savedLang === "fr"
						? "Une erreur est survenue. Veuillez reessayer."
						: "An error occurred. Please try again."),
			);
			submitButton.disabled = false;
			submitButton.textContent =
				savedLang === "fr" ? "Envoyer la demande" : "Submit request";
		}
	} catch (error) {
		console.error("Error submitting form:", error);
		alert(
			savedLang === "fr"
				? "Une erreur est survenue. Veuillez reessayer."
				: "An error occurred. Please try again.",
		);
		submitButton.disabled = false;
		submitButton.textContent =
			savedLang === "fr" ? "Envoyer la demande" : "Submit request";
	}
});
