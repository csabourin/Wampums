const translations = {
	fr: {
		skip_link: "Passer au contenu principal",
		nav_login: "Se connecter",
		tagline: "Application web bilingue pour les scouts",
		hero_title:
			"Orchestrez vos réunions hebdomadaires, vos parents et vos équipes en toute sérénité.",
		hero_body:
			"Wampums centralise l'organisation des groupes scouts : agenda des rencontres, présence, progression, communications et documents, pour que chaque réunion soit prête et sécuritaire.",
		badge1: "Planification mobile-first",
		badge2: "Suivi badges et présences",
		badge3: "Parents connectés",
                cta_primary: "Voir une démo",
                cta_secondary: "Découvrir les fonctions",
                card_title: "Tout-en-un pour votre groupe",
                card_subtitle:
                        "Suivi des membres, activités, badges, documents et sécurité.",
                stat1_label: "Réunions prêtes",
                stat2_label: "Présences tracées",
                stat3_label: "Parents informés",

                // Solutions
                solutions_title: "Une trousse complète pour vos opérations",
                solutions_body:
                        "Préparez, animez et suivez vos rencontres avec des tableaux de bord clairs pour l’équipe et les parents.",
                solution1_title: "Préparation hebdomadaire",
                solution1_note: "Planification, équipes et rappels en quelques minutes.",
                solution1_feature1: "Agenda partagé des réunions",
                solution1_feature2: "Activités, objectifs et matériel",
                solution1_feature3: "Assignations par groupe ou rôle",
                solution1_feature4: "Rappels automatiques aux parents",
                solution1_feature5: "Récupération des autorisations",
                solution2_title: "Suivi terrain",
                solution2_note: "Présences, progrès et ressources synchronisés sur mobile.",
                solution2_feature1: "Badges, honneurs et points",
                solution2_feature2: "Présences et observations en direct",
                solution2_feature3: "Tableaux de bord ressources et réservations",
                solution2_feature4: "Notifications et annonces ciblées",
                solution2_feature5: "Documents et fiches santé centralisés",
                solution3_title: "Vue direction",
                solution3_note: "Indicateurs, budgets et conformité pour chaque organisation.",
                solution3_feature1: "Rapports consolidés par groupe",
                solution3_feature2: "Gestion des budgets et dépenses",
                solution3_feature3: "Journal des communications et alertes",
                solution3_feature4: "Exports sécurisés pour les conseils",
                solution3_feature5: "Accès API et domaine personnalisé",
                solution_cta: "Voir la démo",

		// Features
		features_title: "Fonctions conçues pour les unités scoutes",
		features_body:
			"Chaque module est pensé pour les réalités des équipes de responsables et du district : préparation rapide, suivi clair et collaboration avec les parents.",
		feature1_title: "Planification des rencontres",
		feature1_body:
			"Planifiez les activités hebdomadaires, matériaux et responsabilités, avec un calendrier partagé.",
		feature2_title: "Présences et progression",
		feature2_body:
			"Consignez les présences, les points et l'avancement des badges ou honneurs.",
		feature3_title: "Communication aux parents",
		feature3_body:
			"Envoyez des nouvelles, rappels et documents pour que les familles restent alignées.",
		feature4_title: "Gestion des rôles",
		feature4_body:
			"Attribuez les rôles (district, responsables, parents) et sécurisez l'accès aux données.",
		feature5_title: "Documents et consentements",
		feature5_body:
			"Stockez fiches santé, autorisations et rapports pour des activités conformes.",
		feature6_title: "Rapports et export",
		feature6_body:
			"Générez des rapports sur la participation, la progression et les ventes de calendriers.",

		// Weekly
		weekly_title: "Prêt pour chaque réunion hebdomadaire",
		weekly_body:
			"Un fil conducteur clair pour préparer, tenir et archiver vos rencontres avec fiabilité.",
		weekly_step1_title: "Avant la réunion",
		weekly_step1_item1:
			"Ajoutez l'activité, l'objectif d'apprentissage et les ressources nécessaires.",
		weekly_step1_item2:
			"Assignez les responsables et partagez la liste avec l'équipe.",
		weekly_step1_item3:
			"Envoyez un rappel aux parents avec les détails logistiques.",
		weekly_step2_title: "Pendant la réunion",
		weekly_step2_item1:
			"Enregistrez les présences et les points en direct sur mobile.",
		weekly_step2_item2: "Notez les progrès de badges ou tout besoin de suivi.",
		weekly_step2_item3:
			"Consignez les observations pour le rapport de fin de rencontre.",
		weekly_step3_title: "Après la réunion",
		weekly_step3_item1: "Envoyez un compte rendu aux parents et à l'équipe.",
                weekly_step3_item2:
                        "Mettez à jour les inventaires, les budgets et les documents.",
		weekly_step3_item3:
			"Planifiez la prochaine rencontre à partir du modèle existant.",

		// Benefits
		benefits_title: "Pourquoi Wampums aide votre communauté",
		benefit1_title: "Leadership efficace",
		benefit1_body:
			"Moins de gestion de district, plus de temps sur le terrain grâce à des modèles et rappels prêts à l'emploi.",
		benefit2_title: "Parents rassurés",
		benefit2_body:
			"Informations claires, notifications rapides et documents centralisés pour suivre l'avancement.",
		benefit3_title: "Sécurité et conformité",
		benefit3_body:
			"Gestion des autorisations, des rôles et des dossiers pour des activités sécuritaires.",

		// FAQ
                faq_title: "Questions fréquentes",
                faq1_question: "Comment l’équipe reste-t-elle alignée chaque semaine?",
                faq1_answer:
                        "Les préparations de réunions, rappels et tableaux de bord de ressources gardent les activités, le matériel et les autorisations synchronisés.",
                faq2_question: "Peut-on travailler en français et en anglais?",
                faq2_answer:
                        "Oui. Les communications, formulaires et tableaux de bord sont bilingues et adaptés aux réalités locales.",
                faq3_question: "Comment l'équipe reste-t-elle alignée chaque semaine?",
                faq3_answer:
                        "Les préparations de réunions, rappels et tableaux de bord de ressources gardent les activités, le matériel et les autorisations synchronisés.",
                faq4_question: "Mes données sont-elles sécurisées?",
                faq4_answer:
                        "Absolument. Nous utilisons le chiffrement SSL, des sauvegardes automatiques et respectons les normes de confidentialité canadiennes.",

		// CTA
		cta_title: "Prêt à simplifier la gestion de votre groupe?",
		cta_body:
			"Rejoignez des centaines de groupes scouts qui font confiance à Wampums pour leurs réunions hebdomadaires.",
		cta_button: "Demander une démo",

		// Demo Modal
		demo_modal_title: "Demander une démo",
		demo_form_name: "Nom",
		demo_form_email: "Courriel",
		demo_form_organization: "Organisation",
		demo_form_phone: "Téléphone",
		demo_form_message: "Message",
		demo_form_message_help: "Parlez-nous de vos besoins",
		demo_form_submit: "Envoyer la demande",
		demo_form_success:
			"Merci! Votre demande a été soumise avec succès. Vous serez redirigé vers la démo...",
		demo_form_name_error: "Le nom est requis",
		demo_form_email_error: "Courriel invalide",
		demo_form_message_error: "Le message est requis (minimum 10 caractères)",

		footer_note:
			"Conçu pour les groupes scouts qui se rencontrent chaque semaine — simple, bilingue et prêt à l'emploi.",
	},
	en: {
		skip_link: "Skip to main content",
		nav_login: "Sign in",
		tagline: "Bilingual web app for scouting groups",
		hero_title:
			"Coordinate weekly meetings, parents, and crews with confidence.",
		hero_body:
			"Wampums centralizes scout group operations: meeting schedules, attendance, advancement, communications, and documents so every gathering is ready and safe.",
		badge1: "Mobile-first planning",
		badge2: "Badge and attendance tracking",
		badge3: "Parents stay informed",
                cta_primary: "See a demo",
                cta_secondary: "Explore features",
                card_title: "All-in-one for your troop",
                card_subtitle:
                        "Track members, activities, badges, documents, and safety.",
                stat1_label: "Meetings prepared",
                stat2_label: "Attendance captured",
                stat3_label: "Parents updated",

                // Solutions
                solutions_title: "Built for modern scout leadership",
                solutions_body:
                        "Prepare, deliver, and follow up on meetings with clear dashboards for leaders and families.",
                solution1_title: "Weekly prep",
                solution1_note: "Plan activities, teams, and reminders in minutes.",
                solution1_feature1: "Shared meeting calendar",
                solution1_feature2: "Activities, goals, and materials",
                solution1_feature3: "Assignments by group or role",
                solution1_feature4: "Automatic parent reminders",
                solution1_feature5: "Permission collection",
                solution2_title: "On-the-ground tracking",
                solution2_note: "Attendance, progress, and resources synced on mobile.",
                solution2_feature1: "Badges, honors, and points",
                solution2_feature2: "Live attendance and observations",
                solution2_feature3: "Resource and reservation dashboards",
                solution2_feature4: "Targeted notifications and announcements",
                solution2_feature5: "Centralized documents and health forms",
                solution3_title: "Leadership view",
                solution3_note: "Insights, budgets, and compliance for every organization.",
                solution3_feature1: "Consolidated group reporting",
                solution3_feature2: "Budgeting and expense tracking",
                solution3_feature3: "Communication journal and alerts",
                solution3_feature4: "Secure exports for councils",
                solution3_feature5: "API access and custom domains",
                solution_cta: "View demo",

		// Features
		features_title: "Built for weekly scout units",
		features_body:
			"Every module fits real-world leadership needs: quick prep, clear follow-up, and tight parent collaboration.",
		feature1_title: "Meeting planning",
		feature1_body:
			"Schedule weekly activities, materials, and responsibilities with a shared calendar.",
		feature2_title: "Attendance & advancement",
		feature2_body: "Record attendance, points, and badge or honor progress.",
		feature3_title: "Parent communications",
		feature3_body:
			"Send updates, reminders, and documents so families stay aligned.",
		feature4_title: "Role management",
		feature4_body:
			"Assign roles (district, leaders, parents) and secure access to data.",
		feature5_title: "Documents & consents",
		feature5_body:
			"Store health forms, permissions, and reports to keep activities compliant.",
		feature6_title: "Reports & export",
		feature6_body:
			"Generate reports on participation, advancement, and calendar sales.",

		// Weekly
		weekly_title: "Ready for every weekly meeting",
		weekly_body:
			"A clear guide to prepare, deliver, and archive each gathering reliably.",
		weekly_step1_title: "Before the meeting",
		weekly_step1_item1:
			"Add the activity, learning goal, and required resources.",
		weekly_step1_item2: "Assign leaders and share the checklist with the crew.",
		weekly_step1_item3: "Send a reminder to parents with logistics.",
		weekly_step2_title: "During the meeting",
		weekly_step2_item1: "Capture attendance and points live on mobile.",
		weekly_step2_item2: "Log badge progress or any follow-up needs.",
		weekly_step2_item3: "Record observations for the end-of-meeting report.",
		weekly_step3_title: "After the meeting",
		weekly_step3_item1: "Share a recap with parents and the team.",
                weekly_step3_item2: "Update inventories, budgets, and documents.",
		weekly_step3_item3: "Plan the next gathering using the existing template.",

		// Benefits
		benefits_title: "How Wampums supports your community",
		benefit1_title: "Effective leadership",
		benefit1_body:
			"Less district overhead, more time outdoors thanks to ready-to-use templates and reminders.",
		benefit2_title: "Confident parents",
		benefit2_body:
			"Clear information, fast notifications, and centralized documents to follow progress.",
		benefit3_title: "Safety and compliance",
		benefit3_body:
			"Manage permissions, roles, and records to keep activities safe.",

		// FAQ
                faq_title: "Frequently asked questions",
                faq1_question: "How does the team stay aligned each week?",
                faq1_answer:
                        "Meeting preparations, reminders, and resource dashboards keep activities, gear, and permissions in sync.",
                faq2_question: "Can we work in English and French?",
                faq2_answer:
                        "Yes. Communications, forms, and dashboards are bilingual and tuned for local needs.",
                faq3_question: "How does the team stay aligned each week?",
                faq3_answer:
                        "Meeting preparations, reminders, and resource dashboards keep activities, gear, and permissions in sync.",
                faq4_question: "Is my data secure?",
                faq4_answer:
                        "Absolutely. We use SSL encryption, automatic backups, and comply with Canadian privacy standards.",

		// CTA
		cta_title: "Ready to simplify your group management?",
		cta_body:
			"Join hundreds of scout groups who trust Wampums for their weekly meetings.",
		cta_button: "Request a demo",

		// Demo Modal
		demo_modal_title: "Request a demo",
		demo_form_name: "Name",
		demo_form_email: "Email",
		demo_form_organization: "Organization",
		demo_form_phone: "Phone",
		demo_form_message: "Message",
		demo_form_message_help: "Tell us about your needs",
		demo_form_submit: "Submit request",
		demo_form_success:
			"Thank you! Your request has been submitted successfully. You will be redirected to the demo...",
		demo_form_name_error: "Name is required",
		demo_form_email_error: "Invalid email",
		demo_form_message_error: "Message is required (minimum 10 characters)",

		footer_note:
			"Built for scout groups that meet every week — simple, bilingual, and ready to deploy.",
	},
};

const html = document.documentElement;
const buttons = document.querySelectorAll(".lang-toggle button");

function applyTranslations(lang) {
	const copy = translations[lang];
	if (!copy) return;
	html.lang = lang;
	document.title =
		lang === "fr"
			? "Wampums - Gestion des scouts"
			: "Wampums - Scout Management";
	document.querySelectorAll("[data-i18n]").forEach((node) => {
		const key = node.getAttribute("data-i18n");
		if (copy[key]) {
			node.textContent = copy[key];
		}
	});
	buttons.forEach((btn) =>
		btn.setAttribute(
			"aria-pressed",
			btn.dataset.lang === lang ? "true" : "false",
		),
	);
	localStorage.setItem("wampums-lang", lang);
}

buttons.forEach((button) => {
	button.addEventListener("click", () =>
		applyTranslations(button.dataset.lang),
	);
});

// Load saved language preference or default to French
const savedLang = localStorage.getItem("wampums-lang") || "fr";
applyTranslations(savedLang);

// Demo Modal Functionality
const demoModal = document.getElementById("demoModal");
const demoForm = document.getElementById("demoForm");
const formSuccess = document.getElementById("formSuccess");
const demoRedirectForm = document.getElementById("demoRedirectForm");

// Get backend API URL - try to detect from current location
const getApiUrl = () => {
	// If on wampums.app, use the demo API instance
	if (window.location.hostname === "wampums.app") {
		return "https://demo.wampums.app/api/contact-demo";
	}
	// For local development or other domains
	return window.location.origin + "/api/contact-demo";
};

// Open modal
document.querySelectorAll("[data-open-demo-modal]").forEach((button) => {
	button.addEventListener("click", () => {
		demoModal.classList.add("active");
		demoModal.setAttribute("aria-hidden", "false");
		// Focus first input
		document.getElementById("name").focus();
	});
});

// Close modal
const closeModal = () => {
	demoModal.classList.remove("active");
	demoModal.setAttribute("aria-hidden", "true");
	// Reset form
	demoForm.reset();
	formSuccess.classList.remove("active");
	// Clear errors
	document.querySelectorAll(".form-group.error").forEach((group) => {
		group.classList.remove("error");
	});
};

document.querySelectorAll("[data-close-modal]").forEach((button) => {
	button.addEventListener("click", closeModal);
});

// Close on background click
demoModal.addEventListener("click", (e) => {
	if (e.target === demoModal) {
		closeModal();
	}
});

// Close on Escape key
document.addEventListener("keydown", (e) => {
	if (e.key === "Escape" && demoModal.classList.contains("active")) {
		closeModal();
	}
});

// Form validation
const validateEmail = (email) => {
	return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
};

const validateForm = () => {
	let isValid = true;
	const name = document.getElementById("name");
	const email = document.getElementById("email");
	const message = document.getElementById("message");

	// Clear previous errors
	document.querySelectorAll(".form-group.error").forEach((group) => {
		group.classList.remove("error");
	});

	// Validate name
	if (!name.value.trim() || name.value.trim().length < 2) {
		name.closest(".form-group").classList.add("error");
		isValid = false;
	}

	// Validate email
	if (!email.value.trim() || !validateEmail(email.value.trim())) {
		email.closest(".form-group").classList.add("error");
		isValid = false;
	}

	// Validate message
	if (!message.value.trim() || message.value.trim().length < 10) {
		message.closest(".form-group").classList.add("error");
		isValid = false;
	}

	return isValid;
};

// Handle form submission
demoForm.addEventListener("submit", async (e) => {
	e.preventDefault();

	if (!validateForm()) {
		return;
	}

	const submitButton = demoForm.querySelector(".btn-submit");
	submitButton.disabled = true;
	submitButton.textContent =
		savedLang === "fr" ? "Envoi en cours..." : "Sending...";

	try {
		const formData = {
			name: document.getElementById("name").value.trim(),
			email: document.getElementById("email").value.trim(),
			organization: document.getElementById("organization").value.trim(),
			phone: document.getElementById("phone").value.trim(),
			message: document.getElementById("message").value.trim(),
			honeypot: document.getElementById("honeypot").value,
		};

		const response = await fetch(getApiUrl(), {
			method: "POST",
			headers: {
				"Content-Type": "application/json",
			},
			body: JSON.stringify(formData),
		});

                const data = await response.json();

                if (response.ok && data.success) {
                        // Show success message
                        formSuccess.classList.add("active");
                        demoForm.style.display = "none";

                        // Redirect to demo experience after a brief confirmation pause
                        setTimeout(() => {
                                window.location.href = "https://demo.wampums.app";
                        }, 2000);
                } else {
			// Show error
			alert(
				data.message ||
					(savedLang === "fr"
						? "Une erreur est survenue. Veuillez reessayer."
						: "An error occurred. Please try again."),
			);
			submitButton.disabled = false;
			submitButton.textContent =
				savedLang === "fr" ? "Envoyer la demande" : "Submit request";
		}
	} catch (error) {
		console.error("Error submitting form:", error);
		alert(
			savedLang === "fr"
				? "Une erreur est survenue. Veuillez reessayer."
				: "An error occurred. Please try again.",
		);
		submitButton.disabled = false;
		submitButton.textContent =
			savedLang === "fr" ? "Envoyer la demande" : "Submit request";
	}
});
